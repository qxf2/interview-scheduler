# This file is used to create the Github actions for deploying into the server


name: Interview-Scheduler

on:
  push:
    branches:
      -master

jobs:
  deploy-server:
    name: deploy-server
    runs-on: ubuntu-latest
    steps:
        -name: Executing remote ssh commands using Github actions
        uses: qxf2/interview-scheduler@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.PROD_KEY }}
          port: ${{ secrets.port }}
          script: |
              -name:Do the Git pull from the master
              run:git pull origin master
              -name:Move the maintenance page on
              run:mv maintenance_off.html maintenance_on.html
              -name:Install the requirements file
              run:pip install -r requirements.txt
              -name:Run the Migration
              run:python migrate_db.py db migrate
              run:python migrate_db.py db upgrade
              -name:Restart the server
              run:sudo service gunicorn restart
              -name:Move the maintenance page off
              mv maintenance_on.html maintenance_off.html

