name: Interview-Scheduler
on:
  push:
    branches:
      - '**'
jobs:
  test:
    name: Run CI tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Running requirements and server in  background
        run: |
              pip install -r QA/requirements.txt
              touch qxf2_scheduler/email_config.py
              cat > qxf2_scheduler/email_config.py << EOF
              MAIL_USERNAME = "${{ secrets.MAIL_USERNAME }}"
              MAIL_PASSWORD = "${{ secrets.MAIL_PASSWORD }}"
              EOF
              mkdir data
              touch data/candidatestatus.csv
              cat > data/candidatestatus.csv <<EOF
              status_id,status_name
              1,Waiting on Qxf2
              2,Waiting on Candidate
              3,Interview Scheduled
              4,No response
              5,Reject
              6,Hired
              7,Waiting for new opening
              EOF
              python migrate_db.py db init
              python migrate_db.py db migrate
              python migrate_db.py db upgrade
              python qxf2_scheduler/setup_db.py
              python  run.py > /dev/null 2>&1 &
              cd QA/tests
              python -m pytest --ignore==test_isapp_api.py --ignore==test_login_user.py
              pkill -f run.py